!function(e){e.fn.metalClone=function(n,t){var o=cloned=e.extend({},e.fn.metalClone.defaults,n),l=clonedElement=this;return l.each(function(n,t){function a(n,t,o,l){var a,r=t,s="",m="",f=[];if(n=0==n?1:n,e.inArray(g,$)!==-1&&e.inArray(x,$)!==-1)for(var u=0;u<n;u++){if(a=p())return;if(s=r.clone(),W&&(s.children("td").wrapInner('<div class="'+Z+'"></div>'),s.children("td").each(function(n,t){e(t).children("div").slideDown()})),"after"===l?s.insertAfter(o.find("tr").last()):s.insertAfter(o.find("tr").first()),W){var v=s.children("td").length,h=0;s.children("td").children("div").hide().slideDown(function(){s.children("td").children("."+Z).contents().unwrap(),s.find("td").last().append(d("table")),T||i(s),f.push(s),function(n){q&&1==n&&h==v-1&&e(document).triggerHandler("metal-event:scrollTop",{cloned_element:s,scroll_top_speed:z})}(u),h++})}else s.find("td").last().append(d("table")),function(n){q&&0==n&&e(document).triggerHandler("metal-event:scrollTop",{cloned_element:s,scroll_top_speed:z})}(u),T||i(s),f.push(s)}else if(e.inArray(g,$)==-1&&e.inArray(x,$)==-1)for(var u=0;u<n;u++){if(a=p())return;s=r.clone(),W?"after"===l?(o.append(s.append(d("div"))),o.children().last().hide().slideDown(Y)):(o.prepend(s.append(d("div"))),o.children().first().hide().slideDown(Y)):o.prepend(s.append(d("div"))),q&&!function(n){0==n&&e(document).triggerHandler("metal-event:scrollTop",{cloned_element:s,scroll_top_speed:z})}(u),T||i(s),f.push(s)}else if(e.inArray(g,$)==-1&&e.inArray(x,$)!==-1)for(var u=0;u<n;u++){if(a=p())return;s=r.clone(),W?"after"===l?(o.append(s.append(d("div"))),o.children().last().hide().slideDown(Y)):(o.prepend(s.append(d("div"))),o.children().first().hide().slideDown(Y)):"after"===l?o.append(s.append(d("div"))):o.prepend(s.append(d("div"))),function(n){q&&0==n&&e(document).triggerHandler("metal-event:scrollTop",{cloned_element:s,scroll_top_speed:z})}(u),T||i(s),f.push(s)}else if(e.inArray(g,$)!==-1&&e.inArray(x,$)==-1)return console.error("MetalClone Error: Destination provided is not table element. Table rows should exist inside table element"),!1;return e.isArray(D)&&e.isEmptyObject(D)?m=e.map(f,function(n,t){return e(n).get(0)}):e.isArray(D)&&!e.isEmptyObject(D)&&(m=c(D)),m}function r(n,t,o,l){var a,r=t,s="",m="",f=[];if(n=0==n?1:n,e.inArray(g,$)!==-1)for(var u=0;u<n;u++){if(a=p())return;if(s=r.clone(),W&&(s.children("td").wrapInner('<div class="'+Z+'"></div>'),s.children("td").each(function(n,t){e(t).children("div").slideDown()})),"after"===l?s.insertAfter(o):s.insertBefore(o),W){var v=s.children("td").length,h=0;s.children("td").children("div").hide().slideDown(function(){s.children("td").children("."+Z).contents().unwrap(),s.find("td").last().append(d("table")),T||i(s),f.push(s),function(n){q&&1==n&&h==v-1&&e(document).triggerHandler("metal-event:scrollTop",{cloned_element:s,scroll_top_speed:z})}(u),h++})}else s.find("td").last().append(d("table")),function(n){q&&0==n&&e(document).triggerHandler("metal-event:scrollTop",{cloned_element:s,scroll_top_speed:z})}(u),T||i(s),f.push(s)}else if(e.inArray(g,$)==-1)for(var u=0;u<n;u++){if(a=p())return;s=r.clone(),"after"===l?s.insertAfter(o):s.insertBefore(o),W?!function(n){s.hide().slideDown(Y,function(){q&&0==n&&e(document).triggerHandler("metal-event:scrollTop",{cloned_element:s,scroll_top_speed:z})}).append(d("div"))}(u):(s.append(d("div")),function(n){q&&0==n&&e(document).triggerHandler("metal-event:scrollTop",{cloned_element:s,scroll_top_speed:z})}(u)),T||i(s),f.push(s)}return e.isArray(D)&&e.isEmptyObject(D)?m=e.map(f,function(n,t){return e(n).get(0)}):e.isArray(D)&&!e.isEmptyObject(D)&&(m=c(D)),m}function i(n){n.find('input:not("input[type=button], input[type=submit], input[type=checkbox], input[type=radio]"), textarea, select').each(function(){e(this).val("")})}function d(e){var n="",t="";switch(S&&(n='<i class="'+s()+" "+B+'" data-fa-transform="'+N+'" data-fa-mask="'+U+'"></i> '),e){case"table":t='<div class="operation-container"><div class="operations"><div class="'+w+' metal-btn-remove operationsImg" data-metal-ref="'+y+'">'+n+"<span>"+E+"</span></div></div></div>";break;default:t='<button type="button" class="'+w+" metal-btn-remove "+(o.btnRemoveClass&&"number"!=typeof o.btnRemoveClass?o.btnRemoveClass:"")+'" style="margin-bottom: 20px" data-metal-ref="'+y+'">'+n+E+"</button>"}return t}function s(){if(e.inArray(j,G)===-1)return"far";var n;switch(j){case"solid":n="fas";break;case"brand":n="fab";break;case"light":n="fal";break;case"basic":n="fa";break;default:n="far"}return n}function c(n){var t,o=[];return t=e.inArray("*",n)?"*":n.join(","),e(y).not(":first").each(function(n,l){e(this).find(t).each(function(t,o){if(e(this).attr("id")){var l=e(this).attr("id"),a=l.replace(/\d+/g,"");e(this).attr("id",a+parseInt(n))}}),o.push(e(this).get(0))}),o}function m(){var n;return n=e(y).length,"infinity"!=M&&"number"==typeof M?!(_>M)&&n:"no limit"}function f(){var e;return e=ee?y.replace(".",""):y.replace("#","")}function p(){var n,t=m(),o=!1;if(t?n="no limit"==t?0:t:(console.error("MetalClone Error: numberToClone option defined is more than cloneLimit option"),alert("MetalClone Error: numberToClone option defined is more than cloneLimit option"),o=!0),n>M){if(console.log("Can't clone more than limit provided"),e(ne).next().is("span"))e(ne).next().html(H);else{var l=f();e("<span/>",{"data-clone-reference":l,"class":"metal-error-limit"+(L&&"number"!=typeof L?" "+L:""),text:H}).insertAfter(ne)}o=!0}return o}var u=e(t).attr("id")||e(t).attr("class");u||(u=t);var v=Math.floor(99999999999*Math.random()+1);if(e(t).data("metalCloneRef",v),e(t).addClass("metalElement"+v),void 0==e(t).data("metalClone-"+u)){e(t).data("metalClone-"+u,"metalClone");var h,b,C,A=l.selector||"."+u,y=".metalElement"+v,w=y.replace(".","")+"BtnRemove",g=l[0].nodeName,T=o.copyValue,R=o.position,_=o.numberToClone,k=o.destination,D=o.ids,E=o.btnRemoveText,x=k?e(k)[0].nodeName:"none",M=o.cloneLimit,H=o.cloneLimitText,L=o.cloneLimitClass,S=o.enableIcon,j=o.fontAwesomeTheme,B=o.fontAwesomeRemoveClass,I=o.fontAwesomeAddClass,O=o.fontAwesomeAddDataTransform,F=o.fontAwesomeAddDataMask,N=o.fontAwesomeRemoveDataTransform,U=o.fontAwesomeRemoveDataMask,V=o.enableConfirmMessage,Q=o.confirmMessageText,W=o.enableAnimation,Y=o.animationSpeed,q=o.enableScrollTop,z=o.scrollTopSpeed,G=["regular","solid","brand","light","basic"],J=o.onStart,K=o.onClone,P=o.onComplete,X=o.onClonedRemoved,Z="metalRowElementWrapper",$=["TABLE","TR","TD","TBODY","TFOOT","THEAD","TH"],ee=!1;A.match(/[.]/)?(ee=!0,h=e(this).first()):h=e(this),e.isFunction(J)&&J.call(l,l),e.inArray(g,$)!==-1&&(b=h.closest("table"),C=b.find("tr").first());var ne,te;if(null===o.btnClone?(ne="metalBtnClone"+Math.floor(99999999999*Math.random()+1),e.inArray(g,$)!==-1&&e.inArray(x,$)==-1?te=b:e.inArray(g,$)!==-1&&e.inArray(x,$)!==-1?te=b:e.inArray(g,$)==-1&&e.inArray(x,$)==-1?te=t:e.inArray(g,$)==-1&&e.inArray(x,$)!==-1&&(te=t),e("<button/>",{type:"button",text:o.btnCloneText,"class":ne+(o.btnCloneClass&&"number"!=typeof o.btnCloneClass?" "+o.btnCloneClass:""),css:{marginTop:"10px"}}).insertAfter(te),ne="."+ne):ne=o.btnClone,S){var oe='<i class="'+s()+" "+I+'" data-fa-transform="'+O+'" data-fa-mask="'+F+'"></i> ';e(ne).get(0).insertAdjacentHTML("afterbegin",oe)}e(ne).data("metalCloneButtonRef",v),e(document).on({mouseenter:function(){e(this).find(".operations").css({display:"block"})},mouseleave:function(){e(this).find(".operations").css({display:"none"})}},y),e(document).on("click",ne,function(){var n,i=(e(this),"");return function(e){o.cancelClone=function(n){n&&(window[e+"cancelClone"]=n)},o.removeCloned=function(n){n&&(window[e+"removeCloned"]=n)}}(y),e.isFunction(K)&&K.call(l,l,cloned),window[y+"cancelClone"]&&void 0!==typeof window[y+"cancelClone"]?void delete window[y+"cancelClone"]:(k!==!1?(n=e(k),i="after"===R?a(_,h,n,R):a(_,h,n,R)):(n=e(y),i="after"===R?r(_,h,n.last(),R):r(_,h,n.first(),R)),e.isFunction(P)&&P.call(l,e(t),cloned,i),void(window[y+"removeCloned"]&&void 0!==typeof window[y+"removeCloned"]&&(delete window[y+"removeCloned"],e(i).remove(),e.isFunction(X)&&X.call(l,i))))}),e(document).on("click","button."+w+",div."+w,function(){var n,t=e(this).data("metalRef").replace(".",""),a=e(this).closest("tr."+t);return!("boolean"==typeof V&&V&&!confirm(Q))&&(n=f(),a.length?o.enableAnimation?(a.children("td").wrapInner("<div></div>"),a.children("td").children("div").each(function(n,t){e(t).slideUp(Y,function(){n===a.children("td").children("div").length-1&&e(document).triggerHandler("metal-event:onClonedRemoved",{base:l,callback:X,toRemoveElement:a})})})):e(document).triggerHandler("metal-event:onClonedRemoved",{base:l,callback:X,toRemoveElement:a}):o.enableAnimation?e(this).closest(y).slideUp(Y,function(){e(document).triggerHandler("metal-event:onClonedRemoved",{base:l,callback:X,toRemoveElement:e(this).closest(y)})}):e(document).triggerHandler("metal-event:onClonedRemoved",{base:l,callback:X,toRemoveElement:e(this).closest(y)}),void e("body").find('[data-clone-reference="'+n+'"]').remove())})}})},e.fn.metalClone.defaults={destination:!1,position:"after",numberToClone:1,ids:[],btnClone:null,copyValue:!1,btnRemoveText:"Remove",btnRemoveClass:null,btnCloneText:"Create New Element",btnCloneClass:null,cloneLimit:"infinity",cloneLimitText:"Clone limit reached",cloneLimitClass:null,onStart:null,onClone:null,onComplete:null,onClonedRemoved:null,enableIcon:!0,fontAwesomeTheme:"solid",fontAwesomeRemoveClass:"fa-trash-alt",fontAwesomeAddClass:"fa-plus",fontAwesomeAddDataTransform:"",fontAwesomeAddDataMask:"",fontAwesomeRemoveDataTransform:"",fontAwesomeRemoveDataMask:"",enableConfirmMessage:!0,confirmMessageText:"Are you sure?",enableAnimation:!0,animationSpeed:400,enableScrollTop:!0,scrollTopSpeed:1e3},e(document).on("metal-event:onClonedRemoved",function(n,t){t.toRemoveElement.remove(),e.isFunction(t.callback)&&t.callback.call(t.base,t.toRemoveElement)}),e(document).on("metal-event:scrollTop",function(n,t){e("html,body").animate({scrollTop:e(t.cloned_element).offset().top},t.scroll_top_speed)})}(jQuery);