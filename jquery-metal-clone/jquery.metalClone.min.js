!function(e){e.fn.metalClone=function(n,t){opt=cloned=e.extend({},e.fn.metalClone.defaults,n);var o=clonedElement=this;return o.each(function(n,t){function i(n,t,o,i){var r,s=t,p="",u="",d=[];if(n=0==n?1:n,"after"===i){if(e.inArray(A,F)!==-1&&e.inArray(R,F)!==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),p.insertAfter(o.find("tr").last()),p.find("td").last().append('<div class="operation-container"><div class="operations"><div class="metalBtnRemove operationsImg metalDeleteBtn"><span>'+x+"</span></div></div></div>"),h||a(p),d.push(p)}else if(e.inArray(A,F)!==-1&&e.inArray(R,F)==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),o.append(p.append('<input type="button" value="'+x+'" class="metalBtnRemove">')),h||a(p),d.push(p)}else if(e.inArray(A,F)==-1&&e.inArray(R,F)==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),o.append(p.append('<input type="button" value="'+x+'" class="metalBtnRemove">')),h||a(p),d.push(p)}else if(e.inArray(A,F)==-1&&e.inArray(R,F)!==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),o.append(p.append('<input type="button" value="'+x+'" class="metalBtnRemove">')),h||a(p),d.push(p)}}else if("before"===i)if(e.inArray(A,F)!==-1&&e.inArray(R,F)!==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),p.insertAfter(o.find("tr").first()),p.find("td").last().append('<div class="operation-container"><div class="operations"><div class="metalBtnRemove operationsImg metalDeleteBtn"><span>'+x+"</span></div></div></div>"),h||a(p),d.push(p)}else if(e.inArray(A,F)!==-1&&e.inArray(R,F)==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),o.prepend(p.append('<input type="button" value="'+x+'" class="metalBtnRemove">')),h||a(p),d.push(p)}else if(e.inArray(A,F)==-1&&e.inArray(R,F)==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),o.prepend(p.append('<input type="button" value="'+x+'" class="metalBtnRemove">')),h||a(p),d.push(p)}else if(e.inArray(A,F)==-1&&e.inArray(R,F)!==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),o.prepend(p.append('<input type="button" value="'+x+'" class="metalBtnRemove">')),h||a(p),d.push(p)}return e.isArray(B)&&e.isEmptyObject(B)?u=e.map(d,function(n,t){return e(n).get(0)}):e.isArray(B)&&!e.isEmptyObject(B)&&(u=l(B)),u}function r(n,t,o,i){var r,s=t,p="",u="",d=[];if(n=0==n?1:n,"after"===i){if(e.inArray(A,F)!==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),p.insertAfter(o),p.find("td").last().append('<div class="operation-container"><div class="operations"><div class="metalBtnRemove operationsImg metalDeleteBtn"><span>'+x+"</span></div></div></div>"),h||a(p),d.push(p)}if(e.inArray(A,F)==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),p.insertAfter(o).append('<input type="button" value="'+x+'" class="metalBtnRemove">'),h||a(p),d.push(p)}}else if("before"===i)if(e.inArray(A,F)!==-1)for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),p.insertBefore(o),p.find("td").last().append('<div class="operation-container"><div class="operations"><div class="metalBtnRemove operationsImg metalDeleteBtn"><span>'+x+"</span></div></div></div>"),h||a(p),d.push(p)}else for(var f=0;f<n;f++){if(r=c())return;p=s.clone(),p.insertBefore(o).append('<input type="button" value="'+x+'" class="metalBtnRemove">'),h||a(p),d.push(p)}return e.isArray(B)&&e.isEmptyObject(B)?u=e.map(d,function(n,t){return e(n).get(0)}):e.isArray(B)&&!e.isEmptyObject(B)&&(u=l(B)),u}function a(n){n.find('input:not("input[type=button], input[type=submit], input[type=checkbox], input[type=radio]"), textarea, select').each(function(){e(this).val("")})}function l(n){var t,o=[];return t=e.inArray("*",n)?"*":n.join(","),e(v).not(":first").each(function(n,i){e(this).find(t).each(function(t,o){if(e(this).attr("id")){var i=e(this).attr("id"),r=i.replace(/\d+/g,"");e(this).attr("id",r+parseInt(n))}}),o.push(e(this).get(0))}),o}function s(){var n;return n=I?e(v).length:e('[id="'+o[0].id+'"').length,"infinity"!=w&&"number"==typeof w?!(C>w)&&n:"no limit"}function p(){var e;return e=I?v.replace(".",""):v.replace("#","")}function c(){var n,t=s(),o=!1;if(t?n="no limit"==t?0:t:(console.log("Number to clone more than limit"),o=!0),n>w){if(console.log("Can't clone more than limit provided"),e(L).next().is("span"))e(L).next().html(g);else{var i=p();e("<span/>",{"data-clone-reference":i,"class":"error_limit",text:g}).insertAfter(L)}o=!0}return o}var u=e(t).attr("id")||e(t).attr("class");if(u||(u=t),void 0==e(document).data("metalClone-"+u)){e(document).data("metalClone-"+u,"metalClone");var d,f,m,v=o.selector||"."+u,y=v.replace(/^(\.|\#)/,""),A=o[0].nodeName,h=opt.copyValue,b=opt.position,C=opt.numberToClone,T=opt.destination,B=opt.ids,x=opt.btnRemoveText,R=T?e(T)[0].nodeName:"none",w=opt.cloneLimit,g=opt.cloneLimitText,E=opt.onStart,D=opt.onClone,O=opt.onComplete,j=opt.onClonedRemoved,F=["TABLE","TR","TD","TBODY","TFOOT","THEAD","TH"],I=!1;v.match(/[.]/)?(I=!0,d=e(this).first()):d=e(this),e.isFunction(E)&&E.call(o,o),e.inArray(A,F)!==-1&&(f=d.closest("table"),m=f.find("tr").first());var L;null===opt.btnClone?(L="metalBtnClone"+Math.floor(99999999999*Math.random()+1),e.inArray(A,F)!==-1&&e.inArray(R,F)==-1?e("<input/>",{type:"button",value:opt.btnCloneText,"class":L,css:{marginTop:"10px"}}).insertAfter(f):e.inArray(A,F)!==-1&&e.inArray(R,F)!==-1?e("<input/>",{type:"button",value:opt.btnCloneText,"class":L,css:{marginTop:"10px"}}).insertAfter(f):e.inArray(A,F)==-1&&e.inArray(R,F)==-1?e("<input/>",{type:"button",value:opt.btnCloneText,"class":L,css:{marginTop:"10px"}}).insertAfter(v):e.inArray(A,F)==-1&&e.inArray(R,F)!==-1&&e("<input/>",{type:"button",value:opt.btnCloneText,"class":L,css:{marginTop:"10px"}}).insertAfter(v),L="."+L):L=opt.btnClone,e(document).on({mouseenter:function(){e(this).find(".operations").css({display:"block"})},mouseleave:function(){e(this).find(".operations").css({display:"none"})}},v),e(document).on("click",L,function(){var n,t="";return function(e){opt.cancelClone=function(n){n&&(window[e+"cancelClone"]=n)},opt.removeCloned=function(n){n&&(window[e+"removeCloned"]=n)}}(y),e.isFunction(D)&&D.call(o,o,cloned),window[y+"cancelClone"]&&void 0!==typeof window[y+"cancelClone"]?void delete window[y+"cancelClone"]:(T!==!1?(n=e(T),t="after"===b?i(C,d,n,b):i(C,d,n,b)):(n=e(v),t="after"===b?r(C,d,n.last(),b):r(C,d,n.first(),b)),e.isFunction(O)&&O.call(o,clonedElement,cloned,t),void(window[y+"removeCloned"]&&void 0!==typeof window[y+"removeCloned"]&&(delete window[y+"removeCloned"],e(t).remove(),e.isFunction(j)&&j.call(o,t))))}),e(document).on("click",".metalBtnRemove",function(){var n=p(),t=e(this).closest(v).remove();e("body").find('[data-clone-reference="'+n+'"]').remove(),e.isFunction(j)&&j.call(o,t)})}})},e.fn.metalClone.defaults={destination:!1,position:"after",numberToClone:1,ids:[],btnClone:null,copyValue:!1,btnRemoveText:"Remove me",btnCloneText:"Create New Element",cloneLimit:"infinity",cloneLimitText:"Clone limit reached",onStart:null,onClone:null,onComplete:null,onClonedRemoved:null}}(jQuery);