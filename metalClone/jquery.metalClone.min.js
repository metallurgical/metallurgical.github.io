!function(e){e.fn.metalClone=function(t,n){function r(){var t=e("script"),n="";if(t&&t.length>0)for(var r in t){var i=/jquery.metalClone*/g,a=/jquery.metalClone.js|jquery.metalClone.min.js/g;if(t[r].src&&t[r].src.match(i)){n=t[r].src.replace(a,"");break}}return n}function i(t,n,i,a){var l,p=n;if(t=0==t?1:t,"after"===a){if(-1!==e.inArray(v,B)&&-1!==e.inArray(C,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();u.insertAfter(i.find("tr").last()),u.find("td").last().append('<div class="operations"><img src="'+r()+'/images/delete.png" class="metalBtnRemove operationsImg"/> '+g+"</div>"),d||o(u)}else if(-1!==e.inArray(v,B)&&-1==e.inArray(C,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();i.append(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||o(u)}else if(-1==e.inArray(v,B)&&-1==e.inArray(C,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();i.append(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||o(u)}else if(-1==e.inArray(v,B)&&-1!==e.inArray(C,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();i.append(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||o(u)}}else if("before"===a)if(-1!==e.inArray(v,B)&&-1!==e.inArray(C,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();u.insertAfter(i.find("tr").first()),u.find("td").last().append('<div class="operations"><img src="'+r()+'/images/delete.png" class="metalBtnRemove operationsImg"/> '+g+"</div>"),d||o(u)}else if(-1!==e.inArray(v,B)&&-1==e.inArray(C,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();i.prepend(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||o(u)}else if(-1==e.inArray(v,B)&&-1==e.inArray(C,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();i.prepend(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||o(u)}else if(-1==e.inArray(v,B)&&-1!==e.inArray(C,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();i.prepend(u.append('<input type="button" value="'+g+'" class="metalBtnRemove">')),d||o(u)}e.isArray(h)&&e.isEmptyObject(h)||e.isArray(h)&&!e.isEmptyObject(h)&&s(h)}function a(t,n,i,a){var l,p=n;if(t=0==t?1:t,"after"===a){if(-1!==e.inArray(v,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();u.insertAfter(i),u.find("td").last().append('<div class="operations"><img src="'+r()+'/images/delete.png" class="metalBtnRemove operationsImg"/> '+g+"</div>"),d||o(u)}if(-1==e.inArray(v,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();u.insertAfter(i).append('<input type="button" value="'+g+'" class="metalBtnRemove">'),d||o(u)}}else if("before"===a)if(-1!==e.inArray(v,B))for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();u.insertBefore(i),u.find("td").last().append('<div class="operations"><img src="'+r()+'/images/delete.png" class="metalBtnRemove operationsImg"/> '+g+"</div>"),d||o(u)}else for(var c=0;t>c;c++){if(l=f())return;var u=p.clone();u.insertBefore(i).append('<input type="button" value="'+g+'" class="metalBtnRemove">'),d||o(u)}e.isArray(h)&&e.isEmptyObject(h)||e.isArray(h)&&!e.isEmptyObject(h)&&s(h)}function o(t){t.find('input:not("input[type=button], input[type=submit]"), textarea, select').each(function(){e(this).val("")})}function s(t){var n;n=e.inArray("*",t)?"*":t.join(","),e(u).each(function(t,r){e(this).find(n).each(function(n,r){if(e(this).attr("id")){var i=e(this).attr("id"),a=i.replace(/\d+/g,"");e(this).attr("id",a+parseInt(t))}})})}function l(){var t;return t=R?e(u).length:e('[id="'+m[0].id+'"').length,"infinity"!=T&&"number"==typeof T?A>T?!1:t:"no limit"}function p(){var e;return e=R?u.replace(".",""):u.replace("#","")}function f(){var t,n=l(),r=!1;if(n?t="no limit"==n?0:n:(console.log("Number to clone more than limit"),r=!0),t>T){if(console.log("Can't clone more than limit provided"),e(E).next().is("span"))e(E).next().html("Clone limit reached");else{var i=p();e("<span/>",{"data-clone-reference":i,"class":"error_limit",text:"Clone limit reached"}).insertAfter(E)}r=!0}return r}opt=e.extend({},e.fn.metalClone.defaults,t);var c,u=this.selector,m=this,v=this[0].nodeName,d=opt.copyValue,y=opt.position,A=opt.numberToClone,b=opt.destination,h=opt.ids,g=opt.btnRemoveText,C=b?e(b)[0].nodeName:"none",T=opt.cloneLimit,B=["TABLE","TR","TD","TBODY","TFOOT","THEAD","TH"],R=!1;u.match(/[.]/)?(R=!0,c=e(this).first()):c=e(this);var x,j;-1!==e.inArray(v,B)&&(x=c.closest("table"),j=x.find("tr").first());var E;return null===opt.btnClone?(E="metalBtnClone"+Math.floor(99999999999*Math.random()+1),-1!==e.inArray(v,B)&&-1==e.inArray(C,B)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":E,css:{marginTop:"10px"}}).insertAfter(x):-1!==e.inArray(v,B)&&-1!==e.inArray(C,B)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":E,css:{marginTop:"10px"}}).insertAfter(x):-1==e.inArray(v,B)&&-1==e.inArray(C,B)?e("<input/>",{type:"button",value:opt.btnCloneText,"class":E,css:{marginTop:"10px"}}).insertAfter(u):-1==e.inArray(v,B)&&-1!==e.inArray(C,B)&&e("<input/>",{type:"button",value:opt.btnCloneText,"class":E,css:{marginTop:"10px"}}).insertAfter(u),E="."+E):E=opt.btnClone,e(document).on({mouseenter:function(){e(this).find(".operations").css({display:"block"})},mouseleave:function(){e(this).find(".operations").css({display:"none"})}},u),e(document).on("click",E,function(){var t;return b!==!1?(t=e(b),"after"===y?void i(A,c,t,y):void i(A,c,t,y)):(t=e(u),"after"===y?void a(A,c,t.last(),y):void a(A,c,t.first(),y))}),e(document).on("click",".metalBtnRemove",function(){var t=p();e(this).closest(u).remove(),e("body").find('[data-clone-reference="'+t+'"]').remove()}),c.each(function(t,n){e(this)})},e.fn.metalClone.defaults={destination:!1,position:"after",numberToClone:1,ids:[],btnClone:null,copyValue:!1,btnRemoveText:"Remove me",btnCloneText:"Create New Element",cloneLimit:"infinity"}}(jQuery);